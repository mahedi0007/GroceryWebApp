<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{ url_for('static', path='/css/adminstyle.css') }}" rel="stylesheet">

    <title>{{title}}</title>
</head>

<body>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>GroceryApp</h2>
            <span class="close-btn" id="closeSidebar">✕</span>
        </div>

        <a href="/admin">Dashboard</a>
        <a href="/admin/products">Add Products</a>
        <a href="#orders">Orders</a>
        <a href="/admin/createCategories">Categories</a>
        <a href="#">Users</a>
        <a href="#">Profile</a>
    </div>
    <div class="topbar">
        <span class="menu-btn" id="openSidebar">☰</span>
        <h1>Admin Panel</h1>
    </div>
    <section>
        <h2>Create Categories</h2>
        <form id="categoriesForm" action="admin/categories/add" method="post">
            <label>Category Name:</label><br>
            <input type="text" id="category_name" name="category_name" required><br><br>



            <button type="submit">Add Category</button>
        </form>
    </section>
    
    <section class="content" id="">
        <h2>Categories List</h2>
        <div class="table-container" id="Categories">
            
            <table>
                <thead>
                    
                    <tr>
                        <th>Category ID</th>
                        <th>Category Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                {%if category_db %}
                {% for category in category_db %}
                <tbody>
                    
                    <tr>
                        <td data-label="Categories ID">{{category.category_id}}</td>
                        <td data-label="Categories Name">{{category.category_name}}</td>
                        <td data-label="Actions">
                            <a class="edit">Edit</a>
                            <a class="delete" href="/admin/categories/delete/{{category.category_id}}"
                            onclick="return confirm('Are you sure?')">Delete</a>
                            
                        </td>
                    </tr>
                </tbody>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="3" style="text-align: center;">No Categories found</td>
                </tr>
                {% endif %}
            </table>
            
        </div>
    </section>
    <!-- Categories view ends  -->
   <script>

  document.getElementById("categoriesForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const name = document.getElementById("category_name").value.trim();
    if (!name) {
        alert("Category name is required!");
        return;
    }

    const formData = new FormData();
    formData.append("category_name", name);

    try {
        const res = await fetch("/admin/categories/add", {
            method: "POST",
            body: formData
        });

        console.log("Redirect?", res.redirected, "URL:", res.url);

        if (res.redirected && res.url.includes("success=1")) {
            alert("Category Added Successfully!");
            document.getElementById("category_name").value = "";
            return;
        }

        if (res.redirected && res.url.includes("error")) {
            const errorMessage = new URL(res.url).searchParams.get("error");
            alert(errorMessage);
            return;
        }

        alert("Something went wrong while adding the category!");
    }
    catch (err) {
        alert("Failed to connect to server!");
        console.error(err);
    }
});



    // ----------------------------
    // Load categories safely
    // ----------------------------
    


</script>


    <script src="/static/js/script.js"></script>
    <script src="/static/js/add.js"></script>
</body>

</html>